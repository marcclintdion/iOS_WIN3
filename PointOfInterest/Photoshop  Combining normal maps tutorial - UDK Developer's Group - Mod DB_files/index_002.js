$(document).ready(function(){$(".rowdeleted .comment,.rowbury .comment").hide().each(function(){extra=$(this).find(".hidereason").html();$(this).find(".hidereason").remove();$(this).before("<p><a href='#' class='togglecomment'>View comment</a> <em>"+extra+"</em></p>");});$(".togglecomment").toggle(function(){$(this).html("Hide comment");$(this).parent().next().slideDown();},function(){$(this).html("View comment");$(this).parent().next().slideUp();});$(".tablecomments .reply").click(function(){var post=$(this).attr("rel");var link=$(this);if(!$("#commentform").length){return true;}else if($("#"+post+" div.replypostholder").length){}else{$("#"+post+" div.comment").append("<div class=\"replypostholder\"><br /><textarea rows=\"5\" cols=\"50\" class=\"editpost\" id=\"reply"+post+"\"></textarea><div><input type=\"button\" value=\"Cancel\" id=\"cancelreply"+post+"\" /> <input type=\"button\" value=\"Save\" id=\"savereply"+post+"\" style=\"font-weight: bold;\" /></div></div>");$("#cancelreply"+post).click(function(){$("#"+post+" div.replypostholder").remove();});$("#savereply"+post).click(function(){postcontent=$("#reply"+post).val();if(postcontent){$(this).remove();$("#cancelreply"+post).remove();$("#reply"+post).after("<span class=\"ajaxicon\">Saving your reply</span>");$("#commentsummary").val(postcontent)
$("#commentform input[name=replyid]").val(post);$("#commentsubmit").click();}else{$(this).text("Please enter a comment");}});}
return false;});});commentKarma=function(comment,response){if(response['success']){karma=parseInt(comment.parent().find(".karma").html().split(" ",1));karma=karma?(karma+response['karma']):response['karma'];comment.parent().find(".karma").html((karma==1?"+1 vote":(karma>1?"+"+karma+" votes":karma+" votes")));}else if(response['error']){comment.parent().find(".karma").html(response['text']);}};$.fn.uploadToggle=function(rel){$(this).click(function(){$('.upload'+rel).toggle();$('.temp'+rel).toggle();return false;});if($(this).size()){$('.upload'+rel).hide();}};$.fn.formCounter=function(max,text){$(this).each(function(){var val=$(this).val();var id=$(this).attr('id');var cur=val.length;var left=max-cur;$('#'+id+'counter').html(left.toString()+' characters remaining'+text);$(this).keyup(function(){var val=$(this).val();var cur=val.length;var left=max-cur;if(left<0){left=0;$(this).val(val.substr(0,max));}
$('#'+id+'counter').html(left.toString()+' characters remaining'+text);return this;});});return this;};$.fn.convertToButton=function(holder){var select=$(this);var holder=$("<span class="+(holder?holder:"selectholder")+"></span>");$(this).hide().after(holder).find("option").each(function(){holder.append("<span "+($(this).attr("selected")?"class=selecton ":"")+"rel=\""+$(this).val()+"\">"+$(this).text()+"</span>");});holder.find("span").click(function(){if($(this).hasClass("selecton")){$(this).removeClass("selecton");select.find("option[value="+$(this).attr("rel")+"]").removeAttr("selected");}else{$(this).addClass("selecton");select.find("option[value="+$(this).attr("rel")+"]").attr("selected","selected");}});return this;};$.fn.formRepeater=function(containerclass,max,original){var repeats=$("."+containerclass).size()+1;$("."+containerclass+":first").find(".remove").hide();$("."+containerclass).find(".remove").click(function(){return removeRepeat($(this));});$(this).click(function(){if(original){$(this).before($("."+containerclass+":first").clone());$("."+containerclass+":first").find("input").val("").focus();$("."+containerclass+":last").find(".remove").show().click(function(){return removeRepeat($(this));});}else{$(this).before($("."+containerclass+":first").clone(true));$("."+containerclass+":last").find("input").val("");$("."+containerclass+":last").find("textarea").val("");$("."+containerclass+":last").find(".remove").show();}
if(repeats>=max){$(this).hide();}
repeats++;return false;});function removeRepeat(field){if(repeats>1){field.parent("."+containerclass).remove();repeats--;}
return false;}};$.fn.formPreview=function(previewurl,previewarea,previewtext,callback){$(this).before("<span class='ajaxicon' id='ajaxpreview'>&nbsp;</span>");$.ajax({type:"POST",url:urlPath(previewurl),timeout:60000,dataType:"json",data:{preview:previewtext},error:function(response,error,exception){previewarea.html("<p>An error has occured loading your comment preview. Please try again.").parent().fadeIn("def",callback);$("#ajaxpreview").remove();},success:function(response){previewarea.html(response).parent().fadeIn("def",callback);$("#ajaxpreview").remove();}});return false;};$.fn.formAutoResize=function(options){var settings=$.extend({onResize:function(){},animate:true,animateDuration:150,animateCallback:function(){},extraSpace:20,limit:1000},options);this.filter('textarea').each(function(){var textarea=$(this).css({resize:'none','overflow-y':'hidden'}),origHeight=textarea.height(),clone=(function(){var props=['height','width','lineHeight','textDecoration','letterSpacing'],propOb={};$.each(props,function(i,prop){propOb[prop]=textarea.css(prop);});return textarea.clone().removeAttr('id').removeAttr('name').css({position:'absolute',top:0,left:-9999}).css(propOb).attr('tabIndex','-1').insertBefore(textarea);})(),lastScrollTop=null,updateSize=function(){$(this).unbind('click',updateSize);origHeight=origHeight==0?$(this).height():origHeight;clone.height(0).val($(this).val()).scrollTop(10000);var scrollTop=Math.max(clone.scrollTop(),origHeight)+settings.extraSpace,toChange=$(this).add(clone);if(lastScrollTop===scrollTop){return;}
lastScrollTop=scrollTop;if(scrollTop>=settings.limit){$(this).css('overflow-y','');scrollTop=settings.limit;}
settings.onResize.call(this);settings.animate&&textarea.css('display')==='block'?toChange.stop().animate({height:scrollTop},settings.animateDuration,settings.animateCallback):toChange.height(scrollTop);};textarea.unbind('.dynSiz').bind('keyup.dynSiz',updateSize).bind('keydown.dynSiz',updateSize).bind('change.dynSiz',updateSize).click(updateSize);});return this;};